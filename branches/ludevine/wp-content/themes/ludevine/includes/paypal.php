<?phpclass Paypal {	public static function getToken() {		$ch = curl_init();		curl_setopt($ch, CURLOPT_URL, PAYPAL_URL."oauth2/token");		curl_setopt($ch, CURLOPT_HEADER, false);		curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);		curl_setopt($ch, CURLOPT_POST, true);		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); 		curl_setopt($ch, CURLOPT_USERPWD, PAYPAL_CLIENTID.":".PAYPAL_SECRET);		curl_setopt($ch, CURLOPT_POSTFIELDS, "grant_type=client_credentials");				$result = curl_exec($ch);		curl_close($ch);		if(empty($result))die("Error: No response.");		else {		    return json_decode($result,true);		}		exit;	}	public static function createPayment($token,$cart) {		$detail = '';		$item_list = array();		$total = 0;		foreach ($cart as $product_id => $item) {			$total+= $item['total'];			$item_list[] = array(				'quantity' => $item['quantity'],				'name' => $item['post_title'],				'price' => $item['price'],				'sku' => $product_id,				'currency' => 'USD'			);		}		if($total <= 0) exit;		$detail = array('subtotal' => $total,'shipping' => PAYMENT_SHIPPING_FEE);		$total += PAYMENT_SHIPPING_FEE;		$data = '{		  "intent":"sale",		  "redirect_urls":{		    "return_url":"'.DOMAIN.'/payment_return",		    "cancel_url":"'.DOMAIN.'/payment_cancel"		  },		  "payer":{		    "payment_method":"paypal"		  },		  "transactions":[		    {		      "amount":{		        "total":"'.$total.'",		        "currency":"USD",		        "details" : '.json_encode($detail).'		      },		      "description":"Pay for order on ludevine.com",		      "item_list": {		      	"items" : '.json_encode($item_list).'		      }		    }		  ]		}';		$ch = curl_init();		curl_setopt($ch, CURLOPT_URL, PAYPAL_URL."payments/payment");		$header = array(			'Content-Type:application/json',			"Authorization:{$token['token_type']} {$token['access_token']}"		);		curl_setopt($ch, CURLOPT_HEADER, false);		curl_setopt ( $ch , CURLOPT_HTTPHEADER, $header );		curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);		curl_setopt($ch, CURLOPT_POST, true);		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); 		curl_setopt($ch, CURLOPT_POSTFIELDS, $data);		$result = curl_exec($ch);		curl_close($ch);		if(empty($result))die("Error: No response.");		else {		    return json_decode($result,true);		}		exit;	}	public static function queryOrder($token,$paypalOrderId) {		$header = array(			'Content-Type:application/json',			"Authorization:{$token['token_type']} {$token['access_token']}"		);		$ch = curl_init();		curl_setopt($ch, CURLOPT_URL, PAYPAL_URL."payments/sale/".$paypalOrderId);		curl_setopt($ch, CURLOPT_HEADER, false);		curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);		curl_setopt ( $ch , CURLOPT_HTTPHEADER, $header );		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); 		$result = curl_exec($ch);		curl_close($ch);		if(empty($result))die("Error: No response.");		else {		    return json_decode($result,true);		}		exit;	}}